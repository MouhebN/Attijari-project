<div class="container mt-4">
  <h2 class="cheque-title">Liste des fichiers - Chèque 32</h2>

  <!-- Recherche avancée -->
  <app-advanced-search
    [showDateRange]="true"
    (filtersChanged)="onSearchFiltersChanged($event)">
  </app-advanced-search>

  <!-- Statistiques -->
  <div class="stats-section mb-4" *ngIf="fichiers.length > 0">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div class="stats-info">
                <span class="badge bg-primary me-2">
                  <i class="ti ti-file me-1"></i>
                  Total: {{ getStats().totalFichiers }}
                </span>
                <span class="badge bg-success me-2">
                  <i class="ti ti-calculator me-1"></i>
                  Nombre total: {{ getStats().totalNombre }}
                </span>
                <span class="badge bg-info me-2">
                  <i class="ti ti-currency-dollar me-1"></i>
                  Montant total: {{ getStats().totalMontant | number:'1.2-2' }} DT
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div *ngIf="datatableOptions; else loading">
    <app-advanced-datatable
      [options]="datatableOptions"
      [showSearchBar]="false"
      [showActions]="true"
      [showPagination]="true"
      [showStats]="true"
      [itemsPerPage]="10"
      (editItem)="onEditFichier($event)"
       (deleteItem)="onDeleteFichier($event)">
    </app-advanced-datatable>

  </div>
  <div class="modal-backdrop" *ngIf="isEditModalOpen">
    <div class="modal">
      <h4>Modifier le fichier</h4>

      <div class="form-group mb-2">
        <label>Nom du fichier (sans extension)</label>
        <input class="form-control" [(ngModel)]="nomFichierBase" placeholder="Nom du fichier" />
      </div>

      <div class="form-group mb-2">
        <label>Code Valeur</label>
        <input class="form-control" [(ngModel)]="fichierSelectionne!.codeValeur" placeholder="ex: 30" />
      </div>

      <div class="form-group mb-2">
        <label>Code EN</label>
        <input class="form-control" [(ngModel)]="fichierSelectionne!.codEn" />
      </div>

      <div class="form-group mb-2">
        <label>Nombre</label>
        <input type="number" class="form-control" [(ngModel)]="fichierSelectionne!.nombre" />
      </div>

      <div class="form-group mb-2">
        <label>Montant</label>
        <input type="number" class="form-control" [(ngModel)]="fichierSelectionne!.montant" />
      </div>

      <div class="modal-footer mt-3 d-flex justify-content-end">
        <button  (click)="fermerEditModal()">Annuler</button>
        <button  (click)="sauvegarderModificationsFichier()">Mettre à jour</button>
      </div>
    </div>
  </div>


  <!-- Loading -->
  <ng-template #loading>
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">Chargement des fichiers...</p>
    </div>
  </ng-template>
</div>
